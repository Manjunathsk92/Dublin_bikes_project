<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta charset="utf-8">
    <title>Station Details</title>
    <style>
      /* Always set the map height explicitly to define the size of the div
       * element that contains the map. */
      #map {
        height: 70%;
      }
      /* Optional: Makes the sample page fill the window. */
      html, body {
        height: 100%;
        margin: 0;
        padding: 0;
      }
    </style>
  </head>
    
  <body>
      <header>Dublin Bikes</header>
    <div id="map"></div>
      
      
   <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC36Mq4sQqGL0ePgZRKN_FqCeY1olujJFM&callback=initMap">
    </script>
      
    <script>
    alert("In map");
      var map;
      function initMap() {
        var mapAttributes = {
            center:new google.maps.LatLng(53.34535,-6.2708991),
            zoom:13,
            mapTypeId:google.maps.MapTypeId.ROADMAP
        };
        //create map object
        map=new google.maps.Map(document.getElementById("map"), mapAttributes);
       
	
        //call function to display markers
        alert("In map asdasd");
        displayStationMarker(mapAttributes);
      }
/*jsonFile = "Dublin.json";
alert(jsonFile);
var data = readTextFile(jsonFile);
    alert(data);
      function readTextFile(file)
        {
    //function which reads the text file containing the latest dublin bikes data    
        var rawFile = new XMLHttpRequest();
        rawFile.open("GET", file, false);
        var JsonResponse;
          alert("Inside read fumm")
        rawFile.onreadystatechange = function ()
        {
            if(rawFile.readyState === 4)
            {

                if(rawFile.status === 200 || rawFile.status == 0)
                {
                    var allText = rawFile.responseText;
                    JsonResponse = parseJson(allText);
                }
            }
        }
        rawFile.send(null);
        alert(JsonResponse);
        return JsonResponse;
    }

    function parseJson(response) {
        alert("parse")
    //function which parses the json file
        var jsonResponse = JSON.parse(response);
        return jsonResponse;
    }*/
           
        
    
        


        
    function displayStationMarker(mapAttributes){
        
        alert("Am in display marker");
       
        var image = {
          url: 'marker.png',
          // This marker is 20 pixels wide by 32 pixels high.
          size: new google.maps.Size(20, 32),
          // The origin for this image is (0, 0).
          origin: new google.maps.Point(0, 0),
          // The anchor for this image is the base of the flagpole at (0, 32).
          anchor: new google.maps.Point(0, 32)
        };
        // Shapes define the clickable region of the icon. The type defines an HTML
        // <area> element 'poly' which traces out a polygon as a series of X,Y points.
        // The final coordinate closes the poly by connecting to the first coordinate.
        var shape = {
          coords: [1, 1, 1, 20, 18, 20, 18, 1],
          type: 'poly'
        };
       
        var getJSON = function(url, callback) {
        var xhr = new XMLHttpRequest();
            xhr.open('GET', url, true);
            xhr.responseType = 'json';
            xhr.onload = function() {
            var status = xhr.status;
            if (status === 200) {
                    callback(null, xhr.response);
                } else {
                    callback(status, xhr.response);
                }
            };
            xhr.send();
        };
         var infowindow =  new google.maps.InfoWindow({
		content: ''
	});
        
        getJSON('https://api.jcdecaux.com/vls/v1/stations?contract=dublin&apiKey=3378133d595b859f4a6143c9794f4eb04ad88d1d',
 function(err, data) {
  if (err !== null) {
    alert('Something went wrong: ' + err);
  } else {
    alert('Your query count: ' + data.length);
      alert('Your query count: ' + data[0]['position']['lat']);
      for (var i = 0; i<data.length; i++){
            var marker = new google.maps.Marker({
                position: {
                    lat: data[i]['position']['lat'],
                    lng: data[i]['position']['lng']
                },
                map: map,
                //icon: defineMarker(dbBikesData[i]['available_bikes'], dbBikesData[i]['bike_stands'],sliderChecked),
                icon: image,
                title: data[i]['name'] + "; available bikes: " + data[i]['available_bikes'] + "; Available bike stands: " + data[i]['available_bike_stands']
            });

            bindInfoWindow(marker, map, infowindow, "<p><b>" + data[i]['name'] +"<br>"+ "<b>Available bikes:<b> " + data[i]['available_bikes'] + "<br>"+ "Available bike stands: " + data[i]['available_bike_stands']+ "</b></p>"); 
      
        }
     
  }
});
        
        
    }
        
function bindInfoWindow(marker, map, infowindow, html) { 
	google.maps.event.addListener(marker, 'click', function() { 
		infowindow.setContent(html); 
		infowindow.open(map, marker); 
	}); 
} 

      
google.maps.event.addDomListener(window, 'load', initialize);
      
    </script>
     
  </body>
</html>
